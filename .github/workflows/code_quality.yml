name: Code Quality

on:
  pull_request:
    branches:
      - develop
      - main
jobs:
  quality:
    name: Quality checks
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install black isort flake8 pep8-naming pytest pytest-django
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # Tests (pytest)
      - name: Pytest
        env:
          # Dummy value (pas une vraie cl√©)
          SECRET_KEY: "ci-dummy-secret-key"
          DJANGO_SETTINGS_MODULE: primeBank.settings.dev
          DEBUG: "False"
          ALLOWED_HOSTS: "localhost,127.0.0.1"
          PYTHONPATH: "${{ github.workspace }}/src"
        run: |
          pytest -q

      - name: Black (format check)
        run: black --check src

      - name: isort (import order)
        run: isort --check-only src

      - name: Flake8 (PEP8, naming, complexity)
        run: flake8 src
